# Release Process

This document outlines the release process for NGINX Kubernetes Gateway (NKG).

## Versioning

NKG uses semantic versioning for its releases. For more information, see https://semver.org.

> Major version zero `(0.Y.Z)` is reserved for development, anything MAY change at any time. The public API is not stable.

## Release Planning and Development

The features that will go into the next release are reflected in the
corresponding [milestone](https://github.com/nginxinc/nginx-kubernetes-gateway/milestones). Refer to
the [Issue Lifecycle](../ISSUE_LIFECYCLE.md) document for information on issues creation and assignment to releases.

## Releasing

Note: in the instructions below, `X` stands for the major version, `Y` -- minor, `Z` -- patch.

### Major or Minor Release

A Major or minor introduces new features.

To create a new release, follow these steps:

1. Create an issue to define and track release-related activities. Choose a title that follows the
   format `Release X.Y.Z`.
2. Stop merging any new work into the main branch.
3. Test the main branch for release-readiness. For that, use the `edge` containers, which are built from the main
   branch.
4. If a problem is found, prepare a fix PR, merge it into the main branch and return to the previous step.
5. Create a release branch with a name that follows the `release-X.Y` format.
6. Prepare and merge a PR into the release branch to update the repo files for the release:
    1. Update the Helm [Chart.yaml](../deploy/helm-chart/Chart.yaml): the `appVersion` to `X.Y.Z`, the icon and source
       URLs to point at `vX.Y.Z`, and bump the `version`.
    2. Update the Helm [README](../deploy/helm-chart/README.md) `--version` flags in the helm commands to use the stable
       `appVersion` from the previous step.
    3. Adjust the `VERSION` variable in the [Makefile](../Makefile) and the `NKG_TAG` in the
       [conformance tests Makefile](../conformance/Makefile) to `X.Y.Z`.
    4. Update the tag of NKG container images used in the Helm [values.yaml](../deploy/helm-chart/values.yaml) file, the
       [provisioner manifest](../conformance/provisioner/provisioner.yaml)), and all docs to `X.Y.Z`.
    5. Ensure that the `imagePullPolicy` is `IfNotPresent` in the Helm [values.yaml](../deploy/helm-chart/values.yaml)
       file.
    6. Generate the installation manifests by running `make generate-manifests`.
    7. Modify any `git clone` instructions to use `vX.Y.Z` tag.
    8. Update the [README](../README.md) to include information about the release.
    9. Update the [changelog](../CHANGELOG.md). The changelog includes only important (from the user perspective)
       changes to NKG. This is in contrast with the autogenerated full changelog, which is created in the next step. As
       a starting point, copy the important features, bug fixes, and dependencies from the autogenerated draft of the
       full changelog. This draft can be found under
       the [GitHub releases](https://github.com/nginxinc/nginx-kubernetes-gateway/releases) after the release branch is
       created. Use the previous changelog entries for formatting and content guidance.
7. Create and push the release tag in the format `vX.Y.Z`. As a result, the CI/CD pipeline will:
    - Build NKG container images with the release tag `X.Y.Z` and push it to the registry.
    - Package and publish the Helm chart to the registry.
    - Create a GitHub release with an autogenerated changelog and attached release artifacts.
8. Prepare and merge a PR into the main branch to update the [README](../README.md) to include the information about the
   latest release and also the [changelog](../CHANGELOG.md).
9. Close the issue created in Step 1.

### Patch Release

A patch release is for an important fix that cannot wait the next major/minor release.

To create a new release, follow these steps:

1. Create an issue to define and track release-related activities. Choose a title that follows the
   format `Release X.Y.Z`.
2. If the fix applies to both the latest release and the main branch, then:
    1. Prepare and merge a fix PR into the in the main branch.
    2. Prepare and merge a fix PR (with a cherry-pick commit) into the existing release branch.
3. Alternatively, if the fix only applies to the latest release, prepare and merge a fix PR into the existing release
   branch.
4. Test the release branch for release-readiness.
5. If a problem is found, return to Step 2.
6. Follow Steps 6-9 from the [Major or Minor Release](#major-or-minor-release) section.
